---
title: Error Channel Operations
description: Explore various operations on the error channel in Effect, including error mapping, both channel mapping, filtering success values, inspecting errors, exposing errors, merging error and success channels, and flipping error and success channels. Learn how to handle errors effectively in your Effect programming.
sidebar:
  order: 9
---

import { Aside } from "@astrojs/starlight/components"

In Effect you can perform various operations on the error channel of effects. These operations allow you to transform, inspect, and handle errors in different ways. Let's explore some of these operations.

## Map Operations

### mapError

The `Effect.mapError` function is used when you need to transform or modify an error produced by an effect, without affecting the success value. This can be helpful when you want to add extra information to the error or change its type.

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/mapError.ts

```

We can observe that the type in the error channel of our program has changed from `string` to `Error`.

<Aside type="note">
  It's important to note that using the `Effect.mapError` function does not
  change the overall success or failure of the effect. If the mapped effect
  is successful, then the mapping function is ignored. In other words, the
  `Effect.mapError` operation only applies the transformation to the error
  channel of the effect, while leaving the success channel unchanged.
</Aside>

### mapBoth

The `Effect.mapBoth` function allows you to apply transformations to both channels: the error channel and the success channel of an effect. It takes two map functions as arguments: one for the error channel and the other for the success channel.

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/mapBoth.ts

```

After using `mapBoth`, we can observe that the type of our program has changed from `Effect<number, string>` to `Effect<boolean, Error>`.

<Aside type="note">
  It's important to note that using the `mapBoth` function does not change
  the overall success or failure of the effect. It only transforms the
  values in the error and success channels while preserving the effect's
  original success or failure status.
</Aside>

## Filtering the Success Channel

The Effect library provides several operators to filter values on the success channel based on a given predicate.

These operators offer different strategies for handling cases where the predicate fails:

| **API**                              | **Description**                                                                                                                                                                                                                                   |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `filterOrFail`                       | This operator filters the values on the success channel based on a predicate. If the predicate fails for any value, the original effect fails with an error.                                                                                      |
| `filterOrDie` / `filterOrDieMessage` | These operators also filter the values on the success channel based on a predicate. If the predicate fails for any value, the original effect terminates abruptly. The `filterOrDieMessage` variant allows you to provide a custom error message. |
| `filterOrElse`                       | This operator filters the values on the success channel based on a predicate. If the predicate fails for any value, an alternative effect is executed instead.                                                                                    |

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/filter.ts

```

It's important to note that depending on the specific filtering operator used, the effect can either fail, terminate abruptly, or execute an alternative effect when the predicate fails. Choose the appropriate operator based on your desired error handling strategy and program logic.

In addition to the filtering capabilities discussed earlier, you have the option to further refine and narrow down the type of the success channel by providing a [user-defined type guard](https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates) to the `filterOr*` APIs.
This not only enhances type safety but also improves code clarity.

**Example: Using a Type Guard**

```ts twoslash file=<rootDir>/error-channel-operations/filter-type-guard.ts

```

In the example above, a guard is used within the `filterOrFail` API to ensure that the `user` is of type `User` rather than `User | null`. This refined type information improves the reliability of your code and makes it more understandable.

If you prefer, you can utilize a pre-made guard like [Predicate.isNotNull](https://effect-ts.github.io/effect/effect/Predicate.ts.html#isnotnull) for simplicity and consistency.

## Inspecting Errors

Similar to [tapping](/getting-started/building-pipelines#tap) for success values, Effect provides several operators for inspecting error values.
These operators allow developers to observe failures or underlying issues without modifying the outcome.

| API             | Description                                                                                                                     |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| `tapError`      | Executes an effectful operation to inspect the failure of an effect without altering it.                                        |
| `tapErrorTag`   | Specifically inspects a failure with a particular tag, allowing focused error handling.                                         |
| `tapErrorCause` | Inspects the underlying cause of an effect's failure.                                                                           |
| `tapDefect`     | Specifically inspects non-recoverable failures or defects in an effect (i.e., one or more [Die](/data-types/cause#die) causes). |
| `tapBoth`       | Inspects both success and failure outcomes of an effect, performing different actions based on the result.                      |

<Aside type="note">
  Utilizing these error inspection tools does not alter the outcome or type
  of the effect.
</Aside>

### tapError

Executes an effectful operation to inspect the failure of an effect without altering it.

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/tapError.ts

```

### tapErrorTag

Specifically inspects a failure with a particular tag, allowing focused error handling.

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/tapErrorTag.ts

```

### tapErrorCause

Inspects the underlying cause of an effect's failure.

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/tapErrorCause.ts

```

### tapDefect

Specifically inspects non-recoverable failures or defects in an effect (i.e., one or more [Die](/data-types/cause#die) causes).

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/tapDefect.ts

```

### tapBoth

Inspects both success and failure outcomes of an effect, performing different actions based on the result.

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/tapBoth.ts

```

## Exposing Errors in The Success Channel

The `Effect.either` function transforms an `Effect<A, E, R>` into an effect that encapsulates both potential failure and success within an [Either](/data-types/either) data type:

```ts showLineNumbers=false
Effect<A, E, R> -> Effect<Either<A, E>, never, R>
```

The resulting effect cannot fail because the potential failure is now represented within the `Either`'s `Left` type.
The error type of the returned `Effect` is specified as `never`, confirming that the effect is structured to not fail.

This function becomes especially useful when recovering from effects that may fail when using [Effect.gen](/getting-started/using-generators#understanding-effectgen):

```ts twoslash file=<rootDir>/error-channel-operations/either.ts

```

## Exposing the Cause in The Success Channel

You can use the `Effect.cause` function to expose the cause of an effect, which is a more detailed representation of failures, including error messages and defects.

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/cause.ts

```

## Merging the Error Channel into the Success Channel

Using the `Effect.merge` function, you can merge the error channel into the success channel, creating an effect that always succeeds with the merged value.

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/merge.ts

```

## Flipping Error and Success Channels

Using the `Effect.flip` function, you can flip the error and success channels of an effect, effectively swapping their roles.

**Example**

```ts twoslash file=<rootDir>/error-channel-operations/flip.ts

```
