---
title: Using Generators
description: Explore the syntax of using generators in Effect to write effectful code. Learn about the `Effect.gen` function. Compare `Effect.gen` with `async`/`await` for writing asynchronous code. Understand how generators enhance control flow, handle errors, and utilize short-circuiting in effectful programs. Discover passing references to `this` in generator functions.
sidebar:
  order: 4
---

import { Aside, Tabs, TabItem, Badge } from "@astrojs/starlight/components"

Effect offers a convenient syntax, similar to `async`/`await`, to write effectful code using [generators](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator).

<Aside type="note" title="Optional Feature">
  The use of generators is an optional feature in Effect. If you find
  generators unfamiliar or prefer a different coding style, you can explore
  the documentation about [Building
  Pipelines](/guides/essentials/using-pipelines) in Effect.
</Aside>

## Understanding Effect.gen

The `Effect.gen` utility simplifies the task of writing effectful code by utilizing JavaScript's generator functions. This method helps your code appear and behave more like traditional synchronous code, which enhances both readability and error management.

Let's explore a practical program that performs a series of data transformations commonly found in application logic:

```ts twoslash file=<rootDir>/using-generators/program.ts

```

Key steps to follow when using `Effect.gen`:

- Wrap your logic in `Effect.gen`
- Use `yield*` to handle effects
- Return the final result

<Aside type="caution" title="Required TypeScript Configuration">
  The generator API is only available when using the `downlevelIteration` flag
  or with a `target` of `"es2015"` or higher in your `tsconfig.json` file.
</Aside>

## Comparing Effect.gen with async/await

If you are familiar with `async`/`await`, you may notice that the flow of writing code is similar.

Let's compare the two approaches:

<Tabs syncKey="promises-vs-generators">

<TabItem label="Using Effect.gen">

```ts twoslash file=<rootDir>/using-generators/gen.ts#L3-

```

</TabItem>

<TabItem label="Using Async / Await">

```ts twoslash file=<rootDir>/using-generators/async-await.ts

```

</TabItem>

</Tabs>

It's important to note that although the code appears similar, the two programs are not identical. The purpose of comparing them side by side is just to highlight the resemblance in how they are written.

## Embracing Control Flow

One significant advantage of using `Effect.gen` in conjunction with generators is its capability to employ standard control flow constructs within the generator function. These constructs include `if`/`else`, `for`, `while`, and other branching and looping mechanisms, enhancing your ability to express complex control flow logic in your code.

```ts twoslash file=<rootDir>/using-generators/control-flow.ts

```

## Raising Errors

The `Effect.gen` API allows you to incorporate error handling directly into your program flow by yielding failed effects.
This mechanism, achieved through `Effect.fail`, is demonstrated in the example below:

```ts twoslash file=<rootDir>/using-generators/raising-errors.ts

```

## The Role of Short-Circuiting

When working with the `Effect.gen` API, it's important to understand how it manages errors.
This API is designed to **short-circuit the execution** upon encountering the **first error**.

What does this mean for you as a developer? Well, let's say you have a chain of operations or a collection of effects to be executed in sequence. If any error occurs during the execution of one of these effects, the remaining computations will be skipped, and the error will be propagated to the final result.

In simpler terms, the short-circuiting behavior ensures that if something goes wrong at any step of your program it will immediately stop and return the error to let you know that something went wrong.

```ts twoslash file=<rootDir>/using-generators/short-circuiting.ts

```

<Aside type="note" title="Further Reading">
  If you want to dive deeper into error handling with Effect, you can explore
  the ["Error Management"](/guides/error-management/two-error-types) section.
</Aside>

## Passing `this`

In some cases, you might need to pass a reference to the current object (`this`) into the body of your generator function.
You can achieve this by utilizing an overload that accepts the reference as the first argument:

```ts twoslash file=<rootDir>/using-generators/passing-this.ts

```

## Adapter <Badge text="Deprecated" variant="caution" />

You may still come across some code snippets that use an adapter, typically indicated by `_` or `$` symbols.

In earlier versions of TypeScript, the generator "adapter" function was necessary to ensure correct type inference within generators. This adapter was used to facilitate the interaction between TypeScript's type system and generator functions.

```ts twoslash file=<rootDir>/using-generators/adapter.ts

```

With advances in TypeScript (v5.5+), the adapter is no longer necessary for type inference. While it remains in the codebase for backward compatibility, it is anticipated to be removed in the upcoming major release of Effect.
